cmake_minimum_required(VERSION 3.22.1)
project(comitton C CXX ASM)
include(FetchContent)

FetchContent_Declare(
  libjxl
  GIT_REPOSITORY https://github.com/libjxl/libjxl
  GIT_TAG        v0.7.0
  PATCH_COMMAND  ./deps.sh
)

set(JPEGXL_VERSION "v0.7.0" CACHE INTERNAL "")
set(JPEGXL_STATIC ON CACHE INTERNAL "")
set(BUILD_TESTING OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_DOXYGEN OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_MANPAGES OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_EXAMPLES OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_SJPEG OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_OPENEXR OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_SKCMS OFF CACHE INTERNAL "")
set(JPEGXL_BUNDLE_SKCMS OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_TRANSCODE_JPEG OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_TOOLS OFF CACHE INTERNAL "")
set(JPEGXL_ENABLE_BENCHMARK OFF CACHE INTERNAL "")

FetchContent_MakeAvailable(libjxl)

execute_process(
  COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/copy_headers.sh "${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}include"
  WORKING_DIRECTORY "${libjxl_SOURCE_DIR}/lib/include"
)
execute_process(
  COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/copy_headers.sh "${CMAKE_ARCHIVE_OUTPUT_DIRECTORY}include"
  WORKING_DIRECTORY "${libjxl_BINARY_DIR}/lib/include"
)
